"use strict";function buildJSONRPCResult(e,r){const t={jsonrpc:"2.0",id:e,result:r};return validateJSONRPCResponse(t),t}function buildJSONRPCError(e=null,r){void 0===r&&(r=createJSONRPCError(-32603,"'err' parameter is missing"));const t={code:r.jsonRPCErrorCode||1,message:r.message,data:{}};for(var a=Object.keys(r),o=0;o<a.length;o++){const e=a[o];"jsonRPCErrorCode"!==e&&"message"!==e&&"expose"!==e&&(t.data[e]=r[e])}return{jsonrpc:"2.0",error:t,id:e}}function validateJSONRPCRequest({jsonrpc:e,method:r,id:t,params:a}){if(validateJSONRPCAttribute(e),!r)throw createJSONRPCError(-32600,"'method' attribute is missing");if("string"!=typeof r)throw createJSONRPCError(-32600,"'method' attribute must be a string");if(validateJSONRPCIdAttribute(t),!(void 0===a||Array.isArray(a)||null!==a&&"object"==typeof a))throw createJSONRPCError(-32602,"'params' attribute must be an array, an object or undefined")}function validateJSONRPCResponse({jsonrpc:e,result:r,error:t,id:a}){if(validateJSONRPCAttribute(e),void 0!==r&&void 0!==t)throw createJSONRPCError(-32603,"A JSON-RPC response cannot have both a 'result' and 'error' attribute");if(void 0!==t){if(!t.code||"number"!=typeof t.code)throw createJSONRPCError(-32603,"A JSON-RPC error response must have a 'code' attribute");if(!t.message||"string"!=typeof t.message)throw createJSONRPCError(-32603,"A JSON-RPC error response must have a 'message' attribute")}validateJSONRPCIdAttribute(a)}function validateJSONRPCAttribute(e){if(!e)throw createJSONRPCError(-32600,"'jsonrpc' attribute is missing");if("2.0"!==e)throw createJSONRPCError(-32600,"'jsonrpc' attribute value must be '2.0'")}function validateJSONRPCIdAttribute(e){if(null!==e&&"number"!=typeof e&&"string"!=typeof e)throw createJSONRPCError(-32600,"'id' attribute must be a number, a string or null")}Object.defineProperty(exports,"__esModule",{value:!0});const errors={"-32700":"Parse error","-32600":"Invalid request","-32601":"Method not found","-32602":"Invalid params","-32603":"Internal error"};function createJSONRPCError(e,r){if(r||(r=errors[String(e)]),!r)return createJSONRPCError(-32603);const t=new Error(r);return t.jsonRPCErrorCode=e,t}function arrayMap(e,r){for(var t=-1,a=null==e?0:e.length,o=Array(a);++t<a;)o[t]=r(e[t],t,e);return o}var _arrayMap=arrayMap;function baseToPairs(e,r){return _arrayMap(r,function(r){return[r,e[r]]})}var _baseToPairs=baseToPairs,commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,r){return e(r={exports:{}},r.exports),r.exports}var freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=_freeGlobal||freeSelf||Function("return this")(),_root=root,Symbol$1=_root.Symbol,_Symbol=Symbol$1,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=_Symbol?_Symbol.toStringTag:void 0;function getRawTag(e){var r=hasOwnProperty.call(e,symToStringTag),t=e[symToStringTag];try{e[symToStringTag]=void 0;var a=!0}catch(e){}var o=nativeObjectToString.call(e);return a&&(r?e[symToStringTag]=t:delete e[symToStringTag]),o}var _getRawTag=getRawTag,objectProto$1=Object.prototype,nativeObjectToString$1=objectProto$1.toString;function objectToString(e){return nativeObjectToString$1.call(e)}var _objectToString=objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag$1=_Symbol?_Symbol.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag$1&&symToStringTag$1 in Object(e)?_getRawTag(e):_objectToString(e)}var _baseGetTag=baseGetTag;function isObject(e){var r=typeof e;return null!=e&&("object"==r||"function"==r)}var isObject_1=isObject,asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(e){if(!isObject_1(e))return!1;var r=_baseGetTag(e);return r==funcTag||r==genTag||r==asyncTag||r==proxyTag}var isFunction_1=isFunction,coreJsData=_root["__core-js_shared__"],_coreJsData=coreJsData,maskSrcKey=function(){var e=/[^.]+$/.exec(_coreJsData&&_coreJsData.keys&&_coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}var _isMasked=isMasked,funcProto=Function.prototype,funcToString=funcProto.toString;function toSource(e){if(null!=e){try{return funcToString.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var _toSource=toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$2=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$1=objectProto$2.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$1).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(e){return!(!isObject_1(e)||_isMasked(e))&&(isFunction_1(e)?reIsNative:reIsHostCtor).test(_toSource(e))}var _baseIsNative=baseIsNative;function getValue(e,r){return null==e?void 0:e[r]}var _getValue=getValue;function getNative(e,r){var t=_getValue(e,r);return _baseIsNative(t)?t:void 0}var _getNative=getNative,DataView=_getNative(_root,"DataView"),_DataView=DataView,Map=_getNative(_root,"Map"),_Map=Map,Promise$1=_getNative(_root,"Promise"),_Promise=Promise$1,Set=_getNative(_root,"Set"),_Set=Set,WeakMap=_getNative(_root,"WeakMap"),_WeakMap=WeakMap,mapTag="[object Map]",objectTag="[object Object]",promiseTag="[object Promise]",setTag="[object Set]",weakMapTag="[object WeakMap]",dataViewTag="[object DataView]",dataViewCtorString=_toSource(_DataView),mapCtorString=_toSource(_Map),promiseCtorString=_toSource(_Promise),setCtorString=_toSource(_Set),weakMapCtorString=_toSource(_WeakMap),getTag=_baseGetTag;(_DataView&&getTag(new _DataView(new ArrayBuffer(1)))!=dataViewTag||_Map&&getTag(new _Map)!=mapTag||_Promise&&getTag(_Promise.resolve())!=promiseTag||_Set&&getTag(new _Set)!=setTag||_WeakMap&&getTag(new _WeakMap)!=weakMapTag)&&(getTag=function(e){var r=_baseGetTag(e),t=r==objectTag?e.constructor:void 0,a=t?_toSource(t):"";if(a)switch(a){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return r});var _getTag=getTag;function mapToArray(e){var r=-1,t=Array(e.size);return e.forEach(function(e,a){t[++r]=[a,e]}),t}var _mapToArray=mapToArray;function setToPairs(e){var r=-1,t=Array(e.size);return e.forEach(function(e){t[++r]=[e,e]}),t}var _setToPairs=setToPairs,mapTag$1="[object Map]",setTag$1="[object Set]";function createToPairs(e){return function(r){var t=_getTag(r);return t==mapTag$1?_mapToArray(r):t==setTag$1?_setToPairs(r):_baseToPairs(r,e(r))}}var _createToPairs=createToPairs;function baseTimes(e,r){for(var t=-1,a=Array(e);++t<e;)a[t]=r(t);return a}var _baseTimes=baseTimes;function isObjectLike(e){return null!=e&&"object"==typeof e}var isObjectLike_1=isObjectLike,argsTag="[object Arguments]";function baseIsArguments(e){return isObjectLike_1(e)&&_baseGetTag(e)==argsTag}var _baseIsArguments=baseIsArguments,objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty,propertyIsEnumerable=objectProto$3.propertyIsEnumerable,isArguments=_baseIsArguments(function(){return arguments}())?_baseIsArguments:function(e){return isObjectLike_1(e)&&hasOwnProperty$2.call(e,"callee")&&!propertyIsEnumerable.call(e,"callee")},isArguments_1=isArguments,isArray=Array.isArray,isArray_1=isArray;function stubFalse(){return!1}var stubFalse_1=stubFalse,isBuffer_1=createCommonjsModule(function(e,r){var t=r&&!r.nodeType&&r,a=t&&e&&!e.nodeType&&e,o=a&&a.exports===t?_root.Buffer:void 0,n=(o?o.isBuffer:void 0)||stubFalse_1;e.exports=n}),MAX_SAFE_INTEGER=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(e,r){return!!(r=null==r?MAX_SAFE_INTEGER:r)&&("number"==typeof e||reIsUint.test(e))&&e>-1&&e%1==0&&e<r}var _isIndex=isIndex,MAX_SAFE_INTEGER$1=9007199254740991;function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER$1}var isLength_1=isLength,argsTag$1="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag$1="[object Function]",mapTag$2="[object Map]",numberTag="[object Number]",objectTag$1="[object Object]",regexpTag="[object RegExp]",setTag$2="[object Set]",stringTag="[object String]",weakMapTag$1="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray(e){return isObjectLike_1(e)&&isLength_1(e.length)&&!!typedArrayTags[_baseGetTag(e)]}typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag$1]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$2]=typedArrayTags[numberTag]=typedArrayTags[objectTag$1]=typedArrayTags[regexpTag]=typedArrayTags[setTag$2]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag$1]=!1;var _baseIsTypedArray=baseIsTypedArray;function baseUnary(e){return function(r){return e(r)}}var _baseUnary=baseUnary,_nodeUtil=createCommonjsModule(function(e,r){var t=r&&!r.nodeType&&r,a=t&&e&&!e.nodeType&&e,o=a&&a.exports===t&&_freeGlobal.process,n=function(){try{return o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=n}),nodeIsTypedArray=_nodeUtil&&_nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?_baseUnary(nodeIsTypedArray):_baseIsTypedArray,isTypedArray_1=isTypedArray,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function arrayLikeKeys(e,r){var t=isArray_1(e),a=!t&&isArguments_1(e),o=!t&&!a&&isBuffer_1(e),n=!t&&!a&&!o&&isTypedArray_1(e),s=t||a||o||n,i=s?_baseTimes(e.length,String):[],c=i.length;for(var u in e)!r&&!hasOwnProperty$3.call(e,u)||s&&("length"==u||o&&("offset"==u||"parent"==u)||n&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||_isIndex(u,c))||i.push(u);return i}var _arrayLikeKeys=arrayLikeKeys,objectProto$5=Object.prototype;function isPrototype(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||objectProto$5)}var _isPrototype=isPrototype;function overArg(e,r){return function(t){return e(r(t))}}var _overArg=overArg,nativeKeys=_overArg(Object.keys,Object),_nativeKeys=nativeKeys,objectProto$6=Object.prototype,hasOwnProperty$4=objectProto$6.hasOwnProperty;function baseKeys(e){if(!_isPrototype(e))return _nativeKeys(e);var r=[];for(var t in Object(e))hasOwnProperty$4.call(e,t)&&"constructor"!=t&&r.push(t);return r}var _baseKeys=baseKeys;function isArrayLike(e){return null!=e&&isLength_1(e.length)&&!isFunction_1(e)}var isArrayLike_1=isArrayLike;function keys(e){return isArrayLike_1(e)?_arrayLikeKeys(e):_baseKeys(e)}var keys_1=keys,toPairs=_createToPairs(keys_1),toPairs_1=toPairs,entries=toPairs_1;function createClientError(e="Unknown client error",r){return _createError(e,r,{expose:!0})}function isClientError(e){return Boolean(e&&e.expose)}function _createError(e,r,{expose:t}){const a=new Error(e);if(a.expose=t,r){var o=entries(r),n=Array.isArray(o),s=0;for(o=n?o:o[Symbol.iterator]();;){var i;if(n){if(s>=o.length)break;i=o[s++]}else{if((s=o.next()).done)break;i=s.value}const e=i,r=e[0],t=e[1];a[r]=t}}return a}function _asyncToGenerator(e){return function(){var r=this,t=arguments;return new Promise(function(a,o){var n=e.apply(r,t);function step(e,r){try{var t=n[e](r),s=t.value}catch(e){return void o(e)}t.done?a(s):Promise.resolve(s).then(_next,_throw)}function _next(e){step("next",e)}function _throw(e){step("throw",e)}_next()})}}const INVOKE_METHOD_VERSION=1;class RemoteResourceJSONRPCHandler{constructor({resource:e,publicMethods:r}){this.resource=e,this.publicMethods=r}handleRequest(e,{awsRequestId:r}={}){var t=this;return _asyncToGenerator(function*(){try{if(validateJSONRPCRequest(e),"invoke"!==e.method)throw createJSONRPCError(-32601);const a=e.params||{},o=a.name,n=a.input,s=a.environment,i=a.version;if(!o)throw createClientError("Method name is missing");if(void 0===i)throw createClientError("'invoke' method version is missing");if(i!==INVOKE_METHOD_VERSION)throw createClientError(`'invoke' method version ${i} is unsupported`);if(!t.publicMethods.includes(o))throw createClientError(`Remote method '${o}' doesn't exist`);let c=yield t.resource[o](n,s);return c&&c.$serialize&&(c=c.$serialize()),buildJSONRPCResult(e.id,{output:c})}catch(t){let a=t;if(!t.jsonRPCErrorCode&&!isClientError(t)){if(r){let e=t.stack||t.message;e=(e=e.replace(/\s+/g," ")).trim(),console.log("[ERROR] "+e)}else console.error(t);let e="An error occurred while running a resource method remotely";r&&(e+=` (awsRequestId: '${r}')`),a=createJSONRPCError(-1,e)}return buildJSONRPCError(e.id,a)}})()}}function _extends(){return(_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}let jsonRPCHandler;function handler(e,{awsRequestId:r},t){jsonRPCHandler.handleRequest(e,{awsRequestId:r}).then(e=>{t(null,e)}).catch(t)}(()=>{const e=require("./definition.json");let r=require("./builder");r.default&&(r=r.default);const t=r(),a=_extends({},e.attributes,t);jsonRPCHandler=new RemoteResourceJSONRPCHandler({resource:a,publicMethods:e.methods})})(),exports.handler=handler;
